define(["exports"],function(exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.PictureDialogController=function(){function PictureDialogController($mdDialog,$translate,Upload,locals){_classCallCheck(this,PictureDialogController),this.$mdDialog=$mdDialog,this.$scope=locals.scope,this.$rootScope=locals.rootScope,this.$translate=$translate,this.Upload=Upload,this.uploaded=!1,this.sizes=["xs","sm","md","lg","xl"],this.files={},this.progress={},this.images=locals.images,this.maxFileSize=1048576,this.showWarning=!1}return _createClass(PictureDialogController,[{key:"hide",value:function(){this.$mdDialog.hide()}},{key:"save",value:function(){this.$scope.$emit("onSaveData",{scope:this.$scope,data:{images:this.images}})}},{key:"submitHandler",value:function(){var _this=this,ignoreFileSize=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Object.keys(this.files).length){var _loop=function(size){var file=_this.files[size];return!ignoreFileSize&&_this.files[size].size>_this.maxFileSize?(_this.showWarning=!0,{v:void 0}):void _this.Upload.upload({url:_this.$rootScope.imageUploadUrl,data:{file:file}}).then(function(resp){_this.images[size]=resp.data.url,Object.keys(_this.images).length===Object.keys(_this.files).length&&(_this.$scope.data.images=_this.images,_this.save(),document.getElementById("ecms-page-content").dispatchEvent(new CustomEvent("updateImages",{bubbles:!1,cancelable:!0,detail:{token:Math.floor(Math.random()*Math.floor(99999999)),currentScope:_this.$scope,images:_this.images}})))},function(resp){_this.$translate("Error while uploading").then(function(translated){_this.$mdToast.show(_this.$mdToast.simple().textContent(translated+" Code: "+resp.status).position("bottom left").hideDelay(3e3))})},function(e){console.log(e.total,e.loaded),_this.progress[size]=parseInt(100*e.loaded/e.total)})};for(var size in this.files){var _ret=_loop(size);if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}this.showWarning&&!ignoreFileSize||this.hide()}}},{key:"closeWarning",value:function(upload){this.showWarning=!1,upload&&this.submitHandler(!0)}}]),PictureDialogController}()});