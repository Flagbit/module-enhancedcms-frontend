define([],function(){"use strict";!function(){function videoBg($window,$q,$timeout){return{restrict:"EA",replace:!0,scope:{videoId:"=?",playlist:"=?",ratio:"=?",loop:"=?",mute:"=?",start:"=?",end:"=?",contentZIndex:"=?",allowClickEvents:"=?",mobileImage:"=?",playerCallback:"&?"},transclude:!0,template:"<div><div></div><div ng-transclude></div></div>",link:function(scope,element){function debounce(func,wait){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,func.apply(context,args)};clearTimeout(timeout),timeout=setTimeout(later,wait)}}function detectIE(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/"),edge=ua.indexOf("Edge/");if(msie>0)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);if(trident>0){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}return edge>0&&parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10)}function getPropertyAllSides(property,func){var sides=["top","right","bottom","left"],getProperty=function(obj,side){return obj[side]=parseInt(func.call(computedStyles,property+"-"+side),10),obj};return sides.reduce(getProperty,{})}function calculateParentDimensions(dimensions,spacers){function calculateSpacerValues(){var spacer,args=Array.prototype.slice.call(arguments),sum=0,sumValues=function(_sum,arg){return spacer[arg]?_sum+spacer[arg]:_sum};for(var key in spacers)spacers.hasOwnProperty(key)&&(spacer=spacers[key],sum+=args.reduce(sumValues,0));return sum}return{width:dimensions.width+calculateSpacerValues("left","right"),height:detectIE()&&detectIE()<12?dimensions.height:dimensions.height+calculateSpacerValues("top","bottom")}}function styleContentElements(){var $content=element.children().eq(1),hasContent=!!$content.children().length,parentChildren=Array.prototype.slice.call(element.parent().children());if(element.parent().css({position:"relative",overflow:"hidden"}),!hasContent){element.css({position:"absolute",left:"0",top:"0"});var i=parentChildren.indexOf(element[0]);i>-1&&parentChildren.splice(i,1),$content=angular.element(parentChildren)}$content.css({position:"relative",zIndex:scope.contentZIndex||99})}function getParentDimensions(){computedStyles=$window.getComputedStyle(element.parent()[0]);var dimensionProperties=["width","height"],spacerProperties=["border","margin"];return detectIE()&&detectIE()<12&&spacerProperties.push("padding"),dimensionProperties=dimensionProperties.reduce(function(obj,property){return obj[property]=parseInt(computedStyles.getPropertyValue(property),10),obj},{}),spacerProperties=spacerProperties.reduce(function(obj,property){return obj[property]=getPropertyAllSides(property,computedStyles.getPropertyValue),obj},{}),calculateParentDimensions(dimensionProperties,spacerProperties)}function getPlayerDimensions(){var aspectHeight=parseInt(parentDimensions.width/scope.ratio,10),aspectWidth=parseInt(parentDimensions.height*scope.ratio,10),useAspectHeight=parentDimensions.height<aspectHeight;return{width:useAspectHeight?parentDimensions.width:aspectWidth,height:useAspectHeight?aspectHeight:parentDimensions.height}}function updateDimensions(){styleContentElements(),parentDimensions=getParentDimensions(),playerDimensions=getPlayerDimensions()}function resizeAndPositionPlayer(){var options={zIndex:1,position:"absolute",width:playerDimensions.width+"px",height:playerDimensions.height+"px",left:parseInt((parentDimensions.width-playerDimensions.width)/2,10)+"px",top:parseInt((parentDimensions.height-playerDimensions.height)/2,10)+"px"};scope.allowClickEvents||(options.pointerEvents="none"),$player.css(options)}function seekToStart(video){video=video||scope,player.seekTo(video.start||0)}function loopVideo(video){var duration,msDuration;video=video||scope,duration=video.end?video.end-(video.start||0):scope.start?player.getDuration()-video.start:player.getDuration(),msDuration=1e3*duration,console.log("duration",msDuration),videoTimeout=setTimeout(function(){scope.playlist?player.nextVideo():seekToStart(video)},msDuration)}function playlistVideoChange(){var videoObj=scope.playlist[player.getPlaylistIndex()];loopVideo(videoObj)}function playerReady(){playerCallback&&$timeout(function(){playerCallback({player:player})}),scope.playlist&&(player.loadPlaylist(videoArr),scope.loop&&player.setLoop(!0)),scope.mute&&!player.isMuted()?player.mute():player.isMuted()&&player.unMute(),seekToStart(),scope.$on("$destroy",function(){videoTimeout&&clearTimeout(videoTimeout),angular.element($window).off("resize",windowResized),player.destroy()})}function playerStateChange(evt){if(evt.data===YT.PlayerState.PLAYING&&($player.css("display","block"),!scope.playlist&&scope.loop&&loopVideo(),scope.playlist&&scope.loop&&playlistVideoChange()),evt.data===YT.PlayerState.UNSTARTED&&scope.playlist){var videoObj=scope.playlist[player.getPlaylistIndex()],videoMute=void 0===videoObj.mute?scope.mute:videoObj.mute;backgroundImage=videoObj.mobileImage||scope.mobileImage||"//img.youtube.com/vi/"+videoObj.videoId+"/maxresdefault.jpg",setBackgroundImage(backgroundImage),$player.css("display","none"),seekToStart(videoObj),videoMute||videoMute&&scope.mute?(console.log("mute"),player.isMuted()||player.mute()):videoMute&&scope.mute||(console.log("unmute"),player.isMuted()&&player.unMute())}}function initVideoPlayer(){updateDimensions();var playerOptions={autoplay:1,controls:0,iv_load_policy:3,cc_load_policy:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,playlist:scope.videoId};player=new YT.Player(playerId,{width:playerDimensions.width,height:playerDimensions.height,videoId:scope.videoId,playerVars:playerOptions,events:{onReady:playerReady,onStateChange:playerStateChange}}),$player=element.children().eq(0),$player.css("display","none"),resizeAndPositionPlayer()}function setBackgroundImage(img){element.parent().css({backgroundImage:"url("+img+")",backgroundSize:"cover",backgroundPosition:"center center"})}var computedStyles,playerId,player,parentDimensions,playerDimensions,videoArr,videoTimeout,ytScript=document.querySelector('script[src="//www.youtube.com/iframe_api"]'),$player=element.children().eq(0),playerCallback=scope.playerCallback,backgroundImage=scope.mobileImage||"//img.youtube.com/vi/"+scope.videoId+"/maxresdefault.jpg";if(playerId="player"+Array.prototype.slice.call(document.querySelectorAll("div[video-id]")).indexOf(element[0]),$player.attr("id",playerId),scope.ratio=scope.ratio||16/9,scope.loop=void 0===scope.loop||scope.loop,scope.mute=void 0===scope.mute||scope.mute,!scope.videoId&&!scope.playlist)throw new Error("Either video-id or playlist must be defined.");if(scope.videoId&&scope.playlist)throw new Error("Both video-id and playlist cannot be defined, please choose one or the other.");scope.playlist&&(videoArr=scope.playlist.map(function(videoObj){return videoObj.videoId}));var windowResized=debounce(function(){updateDimensions(),resizeAndPositionPlayer()},300);if(setBackgroundImage(backgroundImage),!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var ytd;if($window.youTubeIframeAPIReady||(ytd=$q.defer(),$window.youTubeIframeAPIReady=ytd.promise,$window.onYouTubeIframeAPIReady=function(){ytd.resolve()}),ytScript)ytd&&ytd.resolve();else{var tag=document.createElement("script");tag.src="//www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}$window.youTubeIframeAPIReady.then(initVideoPlayer),angular.element($window).on("resize",windowResized)}scope.$watch("videoId",function(current,old){current&&old&&current!==old&&(clearTimeout(videoTimeout),backgroundImage=scope.mobileImage||"//img.youtube.com/vi/"+current+"/maxresdefault.jpg",setBackgroundImage(backgroundImage),$player.css("display","none"),player.loadVideoById(current))}),scope.$watchCollection("playlist",function(current,old){current&&old&&current!==old&&(clearTimeout(videoTimeout),videoArr=current.map(function(videoObj){return videoObj.videoId}),player.loadPlaylist(videoArr),scope.loop&&player.setLoop(!0))})}}}angular.module("angularVideoBg",[]),angular.module("angularVideoBg").directive("videoBg",videoBg),videoBg.$inject=["$window","$q","$timeout"]}()});