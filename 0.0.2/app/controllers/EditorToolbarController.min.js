define(["exports","jquery"],function(exports,_jquery){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _jquery2=_interopRequireDefault(_jquery),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},EditorToolbarController=function(){function EditorToolbarController($rootScope,$scope,$compile,$log,$translate,$mdDialog,$mdToast){_classCallCheck(this,EditorToolbarController),this.$rootScope=$rootScope,this.$scope=$scope,this.$compile=$compile,this.$log=$log,this.$translate=$translate,this.$mdDialog=$mdDialog,this.$mdToast=$mdToast,this.$scope.previewActive=!1}return _createClass(EditorToolbarController,[{key:"initEventListeners",value:function(){_get(EditorToolbarController.prototype.__proto__||Object.getPrototypeOf(EditorToolbarController.prototype),"initEventListeners",this).call(this)}},{key:"getTemplateFile",value:function(){return"editor-toolbar.html"}},{key:"showSourceCode",value:function(){var _this=this;this.$mdDialog.show({templateUrl:this.$rootScope.templateBaseUrl+"/dialog/source-code.html",clickOutsideToClose:!0,parent:document.body,locals:{content:(0,_jquery2["default"])("#ecms-page-content").html().trim()},controller:"DialogController"}).then(function(answer){answer&&(answer.content?(0,_jquery2["default"])("#ecms-page-content").html("").append(_this.$compile(answer.content)(_this.$scope)):""==answer.content&&(0,_jquery2["default"])("#ecms-page-content").html(""))})}},{key:"previewPage",value:function(){var container=(0,_jquery2["default"])("#ecms-builder");this.$scope.previewActive?(this.$rootScope.$broadcast("afterPagePreview"),container.removeClass("ecms-preview")):(container.addClass("ecms-preview"),this.$rootScope.$broadcast("beforePagePreview")),this.$scope.previewActive=!this.$scope.previewActive,this.$rootScope.$safeApply(this.$scope)}},{key:"openPage",value:function(){window.open(document.location.origin+document.location.pathname,"_blank")}},{key:"tidyUpCarousel",value:function(el){el.find(".carousel .carousel-item").attr("style",""),el.find(".carousel .carousel-item img[data-widget]").each(function(index,el){var stillPlaceholder="data:"===el.src.slice(0,5);stillPlaceholder||(el.removeAttribute("data-src"),el.removeAttribute("data-holder-rendered"),el.removeAttribute("style"))})}},{key:"tidyUpElement",value:function(el){this.tidyUpCarousel(el),el.find(".md-panel-outer-wrapper, .ecms-tidyup").remove(),el.find("*").not("iframe, iframe *").each(function(idx,currentEl){var $currentEl=(0,_jquery2["default"])(currentEl);if($currentEl.contents().filter(function(i,el){return 8==el.nodeType}).each(function(i,e){(0,_jquery2["default"])(e).remove()}),$currentEl.hasClass("cke_image_resizer")||$currentEl.hasClass("cke_reset"))return void $currentEl.remove();if("undefined"!=typeof currentEl.attributes){var attributes=_jquery2["default"].map(currentEl.attributes,function(item){var name=item.name;return name.startsWith("ng-")?name:name.startsWith("ecms-")?name:name.startsWith("cke-")?name:name.startsWith("data-cke-")?name:name.startsWith("contenteditable")?name:void 0});_jquery2["default"].each(attributes,function(i,item){$currentEl.removeAttr(item)})}if("undefined"!=typeof currentEl.className){var regex=/\s(cke_.*?)(?=\s)/g;currentEl.className=currentEl.className.replace(regex,""),regex=/\s(ng-.*?)(?=\s)/g,currentEl.className=currentEl.className.replace(regex,"")}})}},{key:"removeUIElements",value:function(html){var UI_SELECTORS=[".ecms-ui"];return html.find(UI_SELECTORS.join(",")).remove(),html}},{key:"savePage",value:function(){var _this2=this;this.$rootScope.$emit("startProcess"),this.$rootScope.$broadcast("beforePageSave");var el=(0,_jquery2["default"])("#ecms-page-content");el=this.removeUIElements(el);var clonedEl=el.clone();this.tidyUpElement(clonedEl),_jquery2["default"].ajax({url:this.$rootScope.saveUrl,type:"post",dataType:"json",data:{id:this.$rootScope.id,content:clonedEl.html(),builder_content:el.html(),config:""},success:function(response){_this2.$rootScope.$emit("stopProcess"),_this2.$mdToast.show(_this2.$mdToast.simple().textContent(response.message).position("bottom left").hideDelay(3e3)),_this2.$rootScope.$broadcast("afterPageSave")},error:function(response){_this2.$rootScope.$emit("stopProcess"),_this2.$translate("Error occured").then(function(translated){_this2.$mdToast.show(_this2.$mdToast.simple().textContent(translated).position("bottom left").hideDelay(3e3))})}})}},{key:"toggleTemplates",value:function(){this.$rootScope.$emit("toggleTemplates")}},{key:"responsive",value:function(){var px=arguments.length>0&&void 0!==arguments[0]&&arguments[0],pageWrapper=(0,_jquery2["default"])(".page-wrapper").first(),viewportSize=(0,_jquery2["default"])(window).width();px||(px=viewportSize),pageWrapper.css("margin","auto"),pageWrapper.css("box-shadow","0 5px 30px rgba(43,135,218,.2)"),"none"==pageWrapper.css("max-width")&&pageWrapper.css("max-width",viewportSize),pageWrapper.animate({"max-width":px},1e3,"easeOutBounce"),(0,_jquery2["default"])("head meta[name=viewport]").attr("content","width="+px+", initial-scale=1, maximum-scale=1.0, user-scalable=no"),document.body.style.opacity=.9999,setTimeout(function(){document.body.style.opacity=1},1)}}]),EditorToolbarController}();exports["default"]=EditorToolbarController});